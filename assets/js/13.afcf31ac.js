(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{516:function(e,s,n){e.exports=n.p+"assets/img/eureka-start.07f24829.png"},517:function(e,s,n){e.exports=n.p+"assets/img/eureka-manager.3e1e57ef.png"},546:function(e,s,n){"use strict";n.r(s);var a=n(22),r=Object(a.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("背景")]),e._v(" "),a("ul",[a("li",[e._v("需求：当服务之间的依赖关系非常复杂时，我们需要服务治理功能，实现对服务之间依赖关系的管理。")]),e._v(" "),a("li",[e._v("微服务架构要解决的首要问题就是服务治理。我们通过注册中心来实现服务治理功能。")]),e._v(" "),a("li",[e._v("注册中心主要实现两个功能：服务注册和服务发现。\n"),a("ul",[a("li",[e._v("服务注册：将服务信息注册到注册中心。")]),e._v(" "),a("li",[e._v("服务发现：从注册中心获取注册服务信息列表。")])])]),e._v(" "),a("li",[e._v("方案：SpringCloud 提供 Eureka 注册中心，解决服务之间依赖关系难以管理的问题。")])])]),e._v(" "),a("h2",{attrs:{id:"注册中心"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注册中心"}},[e._v("#")]),e._v(" 注册中心")]),e._v(" "),a("h3",{attrs:{id:"注册中心实现原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注册中心实现原理"}},[e._v("#")]),e._v(" 注册中心实现原理")]),e._v(" "),a("ul",[a("li",[e._v("注册中心也是一个服务。注册中心会保存其他服务信息，以 serviceId 和 value 形式保存服务信息。\n"),a("ul",[a("li",[e._v("serviceId 保存的是服务名称。")]),e._v(" "),a("li",[e._v("value 保存的是服务 ip + port  列表。因为服务集群时，一个 serviceId 会对应多个服务信息，所以用列表存储服务信息。")])])]),e._v(" "),a("li",[e._v("注册中心与其他服务建立心跳，定时将过期的服务信息从注册中心剔除。")]),e._v(" "),a("li",[e._v("服务定期从注册中心拉取最新的注册服务信息列表。")])]),e._v(" "),a("h2",{attrs:{id:"eureka-介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#eureka-介绍"}},[e._v("#")]),e._v(" Eureka 介绍")]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("Eureka 简介")]),e._v(" "),a("ul",[a("li",[e._v("Eureka 组件是 SpringCloud 提供的注册中心解决方案。")]),e._v(" "),a("li",[e._v("Eureka 实际是 netflix（美国知名视频网站） 开发的，SpringCloud 做了一个整合封装。")])])]),e._v(" "),a("h3",{attrs:{id:"eureka-实现原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#eureka-实现原理"}},[e._v("#")]),e._v(" Eureka 实现原理")]),e._v(" "),a("ul",[a("li",[e._v("Eureka 主要分为：Eureka server 和 Eureka client。")]),e._v(" "),a("li",[e._v("注册中心：服务整合 Eureka server 的服务就是注册中心服务。")]),e._v(" "),a("li",[e._v("需要注册的服务：服务整合 Eureka client 就是需要注册的服务")]),e._v(" "),a("li",[e._v("服务与注册中心会保持心跳；服务会将自己的信息注册到注册中心；服务可以从注册中心拉取注册服务信息列表")]),e._v(" "),a("li",[e._v("服务心跳默认间隔：30s")])]),e._v(" "),a("h3",{attrs:{id:"服务保护机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务保护机制"}},[e._v("#")]),e._v(" 服务保护机制")]),e._v(" "),a("ul",[a("li",[e._v("作用：防止注册的服务信息误剔除，所以注册中心会默认开启服务保护机制")]),e._v(" "),a("li",[e._v("服务保护机制几个配置的作用\n"),a("ul",[a("li",[e._v("剔除服务时间间隔，默认：60s。服务每过剔除时间间隔，会将失效的服务信息从注册中心剔除")]),e._v(" "),a("li",[e._v("服务默认保护时间：15 分钟，")]),e._v(" "),a("li",[e._v("续约阈值默认：0.85。即一个服务在剔除服务时间间隔检查时，需要进行多少次续约，没达标不会马上将服务信息剔除。服务会进入保护状态，在保护时间 15 分钟内，有心跳上来，则认为服务正常，退出保护状态；服务保护时间内都没有心跳上来，在剔除服务时间间隔点检查服务信息是否失效时，将这些服务信息从注册中心剔除。\n"),a("ul",[a("li",[e._v("需要进行的续约次数：（剔除时间间隔/心跳间隔）* 0.85。次数没有大于等于计算值，会认为服务心跳数目不达标。0.85 这个值略高，可能经常触发服务保护，推荐设置：0.5。")]),e._v(" "),a("li",[e._v("服务保护机制的必要性：因为网络抖动等情况，可能导致心跳次数不达标，而不是服务本身出现问题，为了防止注册的服务信息误删除，服务保护机制就应运而生。")])])])])])]),e._v(" "),a("h2",{attrs:{id:"整合-eureka"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整合-eureka"}},[e._v("#")]),e._v(" 整合 Eureka")]),e._v(" "),a("h3",{attrs:{id:"父-pom-的-maven-依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#父-pom-的-maven-依赖"}},[e._v("#")]),e._v(" 父 pom 的 maven 依赖")]),e._v(" "),a("div",{staticClass:"language-maven line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("<dependencyManagement>\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-dependencies</artifactId>\n            \x3c!-- SpringBoot2.0.1 对应 SpringCloud 是 Finchley.RELEASE；SpringBoot2.1.1 以上，对应的SpringCloud是Greenwich.RELEASE--\x3e\n            \x3c!-- <version>Finchley.RELEASE</version>--\x3e\n            <version>Greenwich.RELEASE</version>\n            <type>pom</type>\n            <scope>import</scope>\n        </dependency>\n    </dependencies>\n</dependencyManagement>\n\x3c!-- 注意：这里必须要添加，否则各种依赖有问题 --\x3e\n<repositories>\n    <repository>\n        <id>spring-milestones</id>\n        <name>Spring Milestones</name>\n        <url>https://repo.spring.io/libs-milestone</url>\n        <snapshots>\n            <enabled>false</enabled>\n        </snapshots>\n    </repository>\n</repositories>\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br")])]),a("h3",{attrs:{id:"整合-eureka-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整合-eureka-server"}},[e._v("#")]),e._v(" 整合 eureka server")]),e._v(" "),a("ul",[a("li",[e._v("Eureka server 的 maven 依赖"),a("div",{staticClass:"language-maven line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("\x3c!-- SpringBoot 整合 Eureka 服务端 --\x3e\n<dependency>\n <groupId>org.springframework.cloud</groupId>\n <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>\n</dependency>\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])])]),e._v(" "),a("li",[e._v("application.yml 中的配置"),a("div",{staticClass:"language-.yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("### 服务端口\nserver:\n  port: 8000\nspring:\n  application:\n    ### 服务名称\n    name: eureka-server\neureka:\n  instance:\n    ### 域名。最好设置成本机 ip，如果设置的域名，在服务器域名列表中不能映射到真实 ip，会导致通信异常\n    hostname: 127.0.0.1\n    ### 开启 ip 配置，默认：false-不开启。我们正常使用 hostname 即可\n    prefer-ip-address: true\n    ### 开启 ip 后，这里需要配置服务器真实 ip\n    ip-address: 127.0.0.1\n  server:\n    ### 是否开启自我保护机制。默认：true-开启。\n    ### 自我保护机制是为了防止服务不是由于自身问题，而是网络抖动，无法及时续约，导致服务信息被误剔除的问题\n    enable-self-preservation: true\n    ### 自我保护时间（续约阈值更新间隔）。默认：900000ms 即 900s/15分钟。\n    renewal-threshold-update-interval-ms: 90000\n    ### 续约百分比阈值。默认：0.85。\n    ### 查看每分钟续约的服务次数是否达到 85%，未达到，进入自我保护，当 15分钟内有服务续约则不剔除服务，否则剔除服务\n    renewal-percent-threshold: 0.85\n    ### 剔除间隔时间，默认：60s。每间隔 60s，会判断每个服务是否要被剔除，如果服务超过服务保护时间还没续约，就剔除\n    eviction-interval-timer-in-ms: 60000\n  client:\n    service-url:\n      ### 注册服务集群，要相互注册。目前有三个注册服务，端口分别为：8000,8001,8002，我们服务需要注册到其他注册中心上\n      defaultZone: http://${eureka.instance.ip-address}:8001/eureka/, http://${eureka.instance.ip-address}:8002/eureka/\n    ### 是否注册到注册中心，默认：true-注册。我们服务集群时，需要注册到注册中心；单独一个注册中心，不推荐注册到注册中心\n    register-with-eureka: false\n    ### 是否拉取注册中心服务列表信息，默认：true-拉取。最好开启，不然 eureka 网页端，看不到任何服务的信息\n    fetch-registry: true\n    ### 拉取服务列表的时间间隔，默认：30s\n    registry-fetch-interval-seconds: 30\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br"),a("span",{staticClass:"line-number"},[e._v("25")]),a("br"),a("span",{staticClass:"line-number"},[e._v("26")]),a("br"),a("span",{staticClass:"line-number"},[e._v("27")]),a("br"),a("span",{staticClass:"line-number"},[e._v("28")]),a("br"),a("span",{staticClass:"line-number"},[e._v("29")]),a("br"),a("span",{staticClass:"line-number"},[e._v("30")]),a("br"),a("span",{staticClass:"line-number"},[e._v("31")]),a("br"),a("span",{staticClass:"line-number"},[e._v("32")]),a("br"),a("span",{staticClass:"line-number"},[e._v("33")]),a("br"),a("span",{staticClass:"line-number"},[e._v("34")]),a("br"),a("span",{staticClass:"line-number"},[e._v("35")]),a("br"),a("span",{staticClass:"line-number"},[e._v("36")]),a("br")])])]),e._v(" "),a("li",[e._v("启动类添加注解，服务开启 Eureka Server 功能：@EnableEurekaServer")])]),e._v(" "),a("h3",{attrs:{id:"整合-eureka-client"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整合-eureka-client"}},[e._v("#")]),e._v(" 整合 Eureka client")]),e._v(" "),a("ul",[a("li",[e._v("Eureka client 的 maven 依赖"),a("div",{staticClass:"language-maven line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("\x3c!-- SpringBoot 整合 Eureka 服务端 --\x3e\n<dependency>\n <groupId>org.springframework.cloud</groupId>\n <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\n</dependency>\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("ul",[a("li",[e._v("application.yml 中的配置")])]),e._v(" "),a("div",{staticClass:"language-.yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("server:\n  port: 8100\nspring:\n  application:\n    name: user-server\neureka:\n  instance:\n    prefer-ip-address: true\n    ip-address: 127.0.0.1\n    ### 客户端续约时间，默认：30s\n    lease-renewal-interval-in-seconds: 30\n    ### 发呆时间，默认：90s\n    lease-expiration-duration-in-seconds: 90\n  client:\n    service-url:\n      defaultZone: http://${eureka.instance.ip-address}:8000/eureka/,http://${eureka.instance.ip-address}:8001/eureka/,http://${eureka.instance.ip-address}:8001/eureka/\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br")])])]),e._v(" "),a("li",[e._v("启动类添加注解，服务开启 Eureka Client 功能：@EnableEurekaClient")])]),e._v(" "),a("h2",{attrs:{id:"github-项目-demo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#github-项目-demo"}},[e._v("#")]),e._v(" GitHub 项目 demo")]),e._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://github.com/ChenFengHub/springcloud-demo",target:"_blank",rel:"noopener noreferrer"}},[e._v("整个 demo GitHub 地址"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[e._v("项目运行测试：将三个注册服务启动，然后启动用户服务；进入注册服务管理端：http://localhost:8000，查看注册信息")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("启动服务\n"),a("img",{attrs:{src:n(516),alt:""}})]),e._v(" "),a("ul",[a("li",[e._v("进入注册服务管理端\n"),a("img",{attrs:{src:n(517),alt:""}})])])])])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://github.com/ChenFengHub/springcloud-demo/tree/master/eureka-demo",target:"_blank",rel:"noopener noreferrer"}},[e._v("注册中心和用户服务例子的 Github 地址"),a("OutboundLink")],1)])])])])}),[],!1,null,null,null);s.default=r.exports}}]);